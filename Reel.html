<b:if cond='data:blog.pageType == "item"'>
<style>
    body {
        background: #000;
        color: #fff;
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 0;
    }
    .reels-container {
        height: 100vh;
        overflow-y: scroll;
        -webkit-overflow-scrolling: touch;
        scroll-snap-type: y mandatory;
        position: relative;
    }
    .reel {
        height: 100vh;
        scroll-snap-align: start;
        position: relative;
    }
    video {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    /* Play Button Styling */
    .play-button {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 80px;
        height: 80px;
        display: block;
        cursor: pointer;
        border-radius: 50%;
        background: rgba(0, 0, 0, 0.6);
        border: 2px solid #00bfff;
        padding: 10px;
        z-index: 10;
        display: none; /* Initially hidden */
    }

    .play-button:hover {
        background: rgba(0, 0, 0, 0.8);
    }

    /* Loading Icon */
    .loading-icon {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 50px;
        height: 50px;
        border: 6px solid #00bfff;
        border-top: 6px solid transparent;
        border-radius: 50%;
        animation: spin 1s linear infinite;
        display: none;
    }
    @keyframes spin {
        0% { transform: translate(-50%, -50%) rotate(0deg); }
        100% { transform: translate(-50%, -50%) rotate(360deg); }
    }

    /* Profile Icon */
    .profile-icon {
        position: absolute;
        top: 10px;
        left: 10px;
        width: 30px;
        height: 30px;
        border-radius: 50%;
        background: #00bfff;
        display: flex;
        justify-content: center;
        align-items: center;
        color: white;
        font-size: 18px;
        font-weight: bold;
        cursor: pointer;
    }
</style>

<div class="reels-container" id="reelsContainer">
    <!-- Video elements will be dynamically inserted here -->
</div>

<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
<script>
document.addEventListener("DOMContentLoaded", function() {
    let currentVideoIndex = null;

    async function loadReels() {
        const response = await fetch('https://raw.githubusercontent.com/msplayerapp/-Mitu/refs/heads/main/Yeash%20BD%20TV/Yeash/Yeash.m3u');
        if (!response.ok) return console.error('Failed to load videos');

        const text = await response.text();
        const lines = text.split("\n");
        let reels = [];
        let title = "";

        lines.forEach(line => {
            if (line.startsWith("#EXTINF")) {
                title = line.substring(line.indexOf(",") + 1).trim();
            } else if (line.startsWith("http")) {
                reels.push({ title, url: line.trim(), isLive: line.includes(".m3u8") });
            }
        });

        const container = document.getElementById("reelsContainer");

        reels = reels.sort(() => Math.random() - 0.5); // Shuffle videos

        reels.forEach((reel, index) => {
            let reelElement = document.createElement("div");
            reelElement.className = "reel";
            reelElement.innerHTML = `
                <div class="profile-icon">Y</div>
                <video id="video-${index}" data-index="${index}" loop autoplay muted></video>
                <p style="position: absolute; bottom: 20px; left: 10px; background: rgba(0, 0, 0, 0.5); padding: 5px; border-radius: 5px;">${reel.title}</p>
                <div class="loading-icon" id="loadingIcon-${index}"></div>
                <div class="play-button" id="playButton-${index}">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <polygon points="8,5 19,12 8,19" />
                    </svg>
                </div>
            `;
            container.appendChild(reelElement);

            let video = document.getElementById(`video-${index}`);
            let loadingIcon = document.getElementById(`loadingIcon-${index}`);
            let playButton = document.getElementById(`playButton-${index}`);

            // Handle live TV video
            if (reel.isLive) {
                if (Hls.isSupported()) {
                    let hls = new Hls();
                    hls.loadSource(reel.url);
                    hls.attachMedia(video);
                } else {
                    video.src = reel.url;
                }
                video.setAttribute("data-live", "true");
            } else {
                video.src = reel.url;
            }

            // Play button functionality
            playButton.addEventListener("click", () => {
                if (video.paused) {
                    video.play();
                    playButton.style.display = "none"; // Hide play button when video plays
                } else {
                    video.pause();
                    playButton.style.display = "block"; // Show play button when video is paused
                }
            });

            // Video loading behavior
            video.addEventListener("waiting", () => {
                loadingIcon.style.display = "block"; // Show loading icon when buffering
            });

            video.addEventListener("canplay", () => {
                loadingIcon.style.display = "none"; // Hide loading icon when ready to play
            });

            video.addEventListener("playing", () => {
                loadingIcon.style.display = "none"; // Hide loading icon when video starts playing
            });

            // Play icon auto-hide logic
            let playIconTimeout;
            video.addEventListener('touchstart', () => {
                playButton.style.display = "block"; // Show play icon when touched
                clearTimeout(playIconTimeout);
                playIconTimeout = setTimeout(() => {
                    playButton.style.display = "none"; // Hide play icon after 2 seconds
                }, 2000);
            });

            // Auto play and switch video when scrolling
            video.addEventListener("play", function() {
                if (currentVideoIndex !== null && currentVideoIndex !== index) {
                    const previousVideo = document.getElementById(`video-${currentVideoIndex}`);
                    previousVideo.pause();
                }
                currentVideoIndex = index;
            });

            // Ensure video autoplay with sound when in view
            const options = {
                threshold: 0.5
            };
            const observer = new IntersectionObserver((entries, observer) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.play();
                        entry.target.muted = false; // Ensure sound is enabled
                    } else {
                        entry.target.pause();
                    }
                });
            }, options);
            
            observer.observe(video);
        });
    }

    loadReels();
});
</script>
</b:if>
